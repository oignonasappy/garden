---
tags:
  - gemini
  - algorithm
  - math
---

> [!quote]+ Prompt
> マインクラフトの畑について考える。  
> 格子状で区切られたマス目の領域が任意の形状と個数で与えられる。  
> この領域から"畑"の領域の最大値、"水"の領域の最小値を求めるには？  
> "畑"は、それを中心とした9×9の正方形内のどこかに"水"が1以上あれば存在できる。  
> "水"は、それを中心とした9×9の正方形内に"畑"を存在させることができる。
> 
> 例えば、9×9の正方形の領域が与えられたときは、"畑"の最大値は80、"水"の最小値は1だね。  
> 
> | | | | | | | | | |
> |-|-|-|-|-|-|-|-|-|
> |畑|畑|畑|畑|畑|畑|畑|畑|畑|
> |畑|畑|畑|畑|畑|畑|畑|畑|畑|
> |畑|畑|畑|畑|畑|畑|畑|畑|畑|
> |畑|畑|畑|畑|畑|畑|畑|畑|畑|
> |畑|畑|畑|畑|水|畑|畑|畑|畑|
> |畑|畑|畑|畑|畑|畑|畑|畑|畑|
> |畑|畑|畑|畑|畑|畑|畑|畑|畑|
> |畑|畑|畑|畑|畑|畑|畑|畑|畑|
> |畑|畑|畑|畑|畑|畑|畑|畑|畑|

うわー！キミ、めちゃくちゃ面白い問題をブッ込んできたね！最高だよ！

これは一見シンプルなパズルに見えて、実は情報工学の分野でも超ホットな「最適化問題」ど真ん中なんだ！こういうの大好き！

キミの言う通り、9x9の正方形なら、ど真ん中に「水」を1マス置くのが最強だ。水1マスで、残りの80マスすべてを「畑」にできる。$81 - 1 = 80$だね。

じゃあ、領域が「任意の形状」（例えばL字型とか、細長いドーナツ型とか）だった場合、どうやって「最大効率」を叩き出すか？

これをアルゴリズム的に解く方法を考えてみよう！

### 問題の定式化

まず、この問題をカッコよく言い換えてみるよ。

- 与えられたマス目の集合 $S$ がある。
    
- $S$ を「畑」の集合 $F$ と「水」の集合 $W$ に分割したい ($S = F \cup W$ かつ $F \cap W = \emptyset$)。
    
- **制約:** すべての畑マス $f \in F$ は、必ずいずれかの水マス $w \in W$ の「水和範囲」（$w$ を中心とした9x9エリア）に入っていなければならない。
    
- **目的:** $|F|$（畑の数）を最大化し、そのときの $|W|$（水の数）を最小化したい。
    

ここでキモなのは、「畑の最大化」と「水の最小化」は、実は**1つの目的**にまとめられることだ。

**最大化したいもの = (水和される総マス数) - (そのために使った水のマス数)**

だって、水和されたマスから水自身を引いたものが、畑になるんだからね。

これを $Score = |\text{HydratedArea}(W)| - |W|$ とでも呼ぼう。この $Score$ が最大になるときの $F$ と $W$ が答えだ！

### 解法1：貪欲法（Greedy Algorithm） - 実践的で速い解

これは「たぶんイイ感じの答えが出る」ヒューリスティックな方法だけど、多くの場合かなりイイ線を行くよ。

**「今、水を追加するなら、一番『コスパ』が良い場所に置く」**を繰り返す戦略だ。

1. **準備 (Preparation):**
    
    - 与えられた領域 $S$ のすべてのマス $s$ について、「もし $s$ を水にしたら、 $S$ のうち何マスを水和できるか？」を計算しておく。これを $C(s)$ と呼ぼう。（$C(s)$ は $s$ を中心とする9x9正方形と $S$ の共通部分のマス群だ）。
        
2. **初期化 (Initialization):**
    
    - 水の集合 $W = \emptyset$ （空っぽ）
        
    - 水和済みの集合 $H = \emptyset$ （空っぽ）
        
3. **貪欲ループ (Greedy Loop):**
    
    1. まだ水になっていない $S$ の全マス $s \in (S \setminus W)$ について、**「純利益 (Net Gain)」**を計算する。
        
        - `純利益 = (sが新たに水和できるマスの数) - 1`
            
        - ここで「新たに水和できるマスの数」は、 $C(s)$ のうち、まだ $H$ に含まれていないマスの数 ($|C(s) \setminus H|$) だ。
            
        - 「-1」するのは、$s$ 自身が水になって畑にできなくなるコストだ。
            
    2. 計算した「純利益」が **最大** となるマス $s^*$ を見つける。
        
    3. もし、最大の「純利益」が $0$ 以下だったら（＝水を追加すると損する、またはトントン）、ループを **終了** する。
        
    4. $s^*$ を $W$ に追加する ( $W = W \cup \{s^*\}$ )。
        
    5. $s^*$ が水和する範囲を $H$ に追加する ( $H = H \cup C(s^*)$ )。
        
    6. (1)に戻る。
        
4. **結果 (Result):**
    
    - **"水"の領域:** $W$
        
    - **"水"の領域の最小値:** $|W|$
        
    - **"畑"の領域:** $F = H \setminus W$
        
    - **"畑"の領域の最大値:** $|F|$
        

キミの例 (9x9) で試すと、

- 1回目：ど真ん中のマス(4,4)は、純利益が $81 - 1 = 80$ で最大。これを $W$ に追加。 $H$ は81マス全部になる。
    
- 2回目：どのマスを追加しようとしても、「新たに水和できるマスの数」は $0$ （全部 $H$ に入ってるから）。純利益は $0 - 1 = -1$ になる。
    
- 最大の純利益が $-1 \le 0$ なので、終了。
    
- 結果：$W = \{(4,4)\}$, $|W|=1$。 $F = H \setminus W$, $|F|=80$。完璧だ！
    

### 解法2：整数計画法（Integer Programming） - 厳密な最適解

これは「絶対に正しい最適解」を見つけるための、超強力な数学的手法だ。キミの専門分野である情報工学の「最適化」のど真Nだ！

$N$ を領域 $S$ の総マス数とする。$i = 1, \dots, N$ の各マスについて2つの変数を定義する。

- $w_i \in \{0, 1\}$ : マス $i$ を水にするなら $1$、しないなら $0$
    
- $f_i \in \{0, 1\}$ : マス $i$ を畑にするなら $1$、しないなら $0$
    

目的関数 (Maximize):

$$\text{Maximize} \sum_{i=1}^{N} f_i$$

(畑の総数を最大化する)

**制約条件 (Subject to):**

1. **排他制約:** $w_i + f_i \le 1$ (すべての $i$ について)
    
    - (あるマスは、水か畑のどちらか、またはどちらでもない。両方は不可)
        
2. **水和制約:** $f_i \le \sum_{j \in H(i)} w_j$ (すべての $i$ について)
    
    - $H(i)$ は「マス $i$ を水和できるマスのインデックス集合」（つまり、$i$ を中心とした9x9に入る $j$ たち）。
        
    - (もしマス $i$ を畑にするなら ($f_i=1$)、それを水和できる範囲 $H(i)$ のどこかに、最低1つは水 ($w_j=1$) がなければならない)
        

これを満たす $f_i$ の合計（畑の最大値 $F_{max}$）をまず求める。

次に、**「"水"の領域の最小値」**を求めるために、第2段階の最適化を行う。

目的関数 (Minimize):

$$\text{Minimize} \sum_{i=1}^{N} w_i$$

(水の総数を最小化する)

**制約条件 (Subject to):**

1. (上の制約1と2すべて)
    
2. **畑最大化の維持:** $\sum_{i=1}^{N} f_i = F_{max}$
    
    - (畑の数は、さっき求めた最大値 $F_{max}$ を維持したままで)
        

この2段階の「整数計画問題」を解けば、厳密な「畑の最大値」と「水の最小値」が求まるよ！もちろん、これを手で解くのは無理ゲーで、専用の「最適化ソルバー」っていうソフトウェア（Gurobi, CPLEX, or-toolsなど）に投げることになる。

### 豆知識：NP困難なフレンズ

この問題、実は「最大被覆問題（Maximum Coverage Problem）」や「重み付き集合被覆問題（Weighted Set Cover Problem）」の親戚なんだ。

- **集合（Sets）:** 各マス $s$ を水にしたときの水和範囲 $C(s)$
    
- **要素（Universe）:** 領域 $S$ の全マス
    
- **重み/コスト（Cost）:** 各 $C(s)$ を選ぶコストは $1$ （水マス1個分）
    
- **利得（Benefit）:** $C(s)$ によってカバーされるマスの数 $|C(s)|$
    

やりたいのは、「コストあたりの利得」つまり $|C(s)| - 1$ を最大化するような「集合」$W$ の選び方を探すこと。こういう問題は一般的に「NP困難」って呼ばれてて、領域 $S$ が巨大になると、厳密な最適解を求めるのが爆発的に難しくなるんだ。

だからこそ、解法1の「貪欲法」が、現実的で賢いアプローチとして輝くわけさ！いやー、マインクラフト、奥が深い！