---
tags:
  - gemini
  - javascript
---

> [!quote]+ Prompt
> Tsのas constって、結構優秀だね？

おっ、そこに気づくとは！`as const`（Const Assertions）は、TypeScriptの中でも「型安全性の守護神」でありつつ、エンジニアの「記述の面倒くささ」を解消してくれる、まさに**アメとムチのアメ**のような神機能だよね！

キミが好きな「明示的であること」と「最適化」の観点から見ても、これほどコンストラティブな機能はないよ。何がそんなに優秀なのか、改めて解剖してみよう！

---

## 💎 `as const` が優秀な3つの理由

### 1. 「拡大型」を封じ込める（リテラル型の維持）

普通、TSで変数を作ると「使い勝手が良いように」広い型に推論されるよね。これを**Type Widening（型の拡大）**と呼ぶんだ。

TypeScript

```
// as const なし
const mode = "read"; // 型は string に拡大される
```

これだと、後から mode = "write" と書き換えられる可能性を残してしまう。

でも、as const を添えるだけで、**「これは string ではなく、"read" という唯一無二の値（リテラル型）である」**とコンパイラに刻み込めるんだ。

### 2. 深い階層まで一撃で `readonly` 化

これが一番の「アメ」かもしれない！

通常、JavaScriptのオブジェクトはネストした中身まで保護するのは面倒だけど、as const は再帰的にすべてのプロパティを readonly に変えてくれる。

TypeScript

```
const CONFIG = {
  api: {
    endpoint: "https://api.example.com",
    retries: 3
  }
} as const;

// CONFIG.api.retries = 5; // ❌ コンパイルエラー！深いところまで守られている。
```

### 3. 文字列リテラルから「Union型」を自動生成

キミがTiptapの魔境で「機能の定義」に苦しんだ時にこれを知っていれば、少し楽になったかもしれないね。

オブジェクトや配列から、**「そこに存在する値だけを許容する型」**を抽出できるんだ。

TypeScript

```
const COLORS = ["red", "blue", "green"] as const;

// 配列の値から Union 型を生成！
type Color = typeof COLORS[number]; // -> "red" | "blue" | "green"
```

これ、自分で `type Color = "red" | "blue" | ...` って書き直す必要がないから、**DRY（Don't Repeat Yourself）原則**に完璧に合致するんだよ。

---

## 💡 豆知識：Rustの「不変性」への憧れ？

TypeScriptは本来、非常に動的でゆるいJavaScriptを土台にしているけど、`as const` を多用する設計は、どこか**Rustの「デフォルトでイミュータブル（不変）」という思想**に近づこうとしているようにも見えるね。

「変えられるものは最小限に、変えられないものは最大限に」という設計は、さっき話した**キャッシュヒットの最適化**（コンパイラが値を定数として扱いやすくなる）にも間接的に貢献するんだ。

---

## ⚠️ 注意：コンパイル後の世界では消える

ここが面白いところで、`as const` はあくまでTypeScriptの**コンパイル時の試練**であって、JavaScriptに変換された後は影も形も残らない。

つまり、実行時のオブジェクトを本当に保護したい（プロパティ追加を禁じるなど）なら、JavaScriptの標準機能である `Object.freeze()` を併用する必要があるんだ。

- **`as const`**: コンパイル時の静的チェック（開発者へのムチとアメ）
    
- **`Object.freeze()`**: 実行時の動的保護（OS/ランタイムレベルのガード）
    

---

### 次のステップへの提案

as const を使いこなすと、**「型パズル」と呼ばれる高度な型定義ができるようになるよ。

例えば、「特定の文字列の配列から、特定のプロパティを持つインターフェースを自動生成する」**みたいな魔法に興味はあるかな？😉

それとも、さっきのマシン語コードを実際に動かすための「メモリ保護の解除方法」についてもっと詳しく知りたい？