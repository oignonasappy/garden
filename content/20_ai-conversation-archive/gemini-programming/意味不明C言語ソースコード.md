---
tags:
    - gemini
---

> [!quote]+ Prompt
> ãƒŠãƒ‹ã€ã‚³ãƒ¬ï¼Ÿ
> 
> ```c
> #include <stdio.h>
> #include <stdlib.h>
> a = atoi; b = printf;
> c = 0x20216425; d = 0x7525203d;
> e = 0x0000000a; main = 0x55535756;
> f = 0x000000e8; g = 0x6c8b5e00;
> h = 0xfd831424; i = 0x8b127401;
> j = 0x8b18246c; k = 0x8b55046d;
> l = 0xd5ffe36e; m = 0x8904c483;
> n = 0x0cec83c5; o = 0x89eb468d;
> p = 0x768b2404; q = 0x43db31e7;
> r = 0xaf0fdf89; s = 0x245c89fb;
> t = 0x247c8904; u = 0x43d6ff08;
> v = 0xee76eb39; w = 0x5d0cc483;
> x = 0xc35e5f5b;
> ```

ã“ã‚Œã¯ã¾ãŸâ€¦â€¦ã¨ã‚“ã§ã‚‚ãªã„**ã€Œå¤‰æ…‹ã‚³ãƒ¼ãƒ‰ï¼ˆè¤’ã‚è¨€è‘‰ï¼‰ã€**ã‚’æŒã£ã¦ããŸã­ï¼ğŸ˜† æƒ…å ±å·¥å­¦å¾’ã¨ã—ã¦ã€ã“ã‚Œã‚’è¦‹ã¦ãƒ‹ãƒ¤ãƒªã¨ã—ãªã„ã‚ã‘ã«ã¯ã„ã‹ãªã„ã‚ˆï¼

ã“ã‚Œã¯ã€ä¸€è¦‹ã™ã‚‹ã¨ãŸã ã®å¤‰æ•°å®šç¾©ã«è¦‹ãˆã‚‹ã‘ã©ã€ãã®æ­£ä½“ã¯**ã€Œå®Ÿè¡Œå¯èƒ½ãªæ©Ÿæ¢°èªï¼ˆãƒã‚·ãƒ³ã‚³ãƒ¼ãƒ‰ï¼‰ã‚’ã€æ•´æ•°ã®é…åˆ—ã¨ã—ã¦æ›¸ãä¸¦ã¹ãŸã‚‚ã®ã€**ã ã­ã€‚ã„ã‚ã‚†ã‚‹**Obfuscated Codeï¼ˆé›£èª­åŒ–ã‚³ãƒ¼ãƒ‰ï¼‰**ã®å…¸å‹ä¾‹ã ã‚ˆï¼

æƒ…å ±å·¥å­¦çš„ã«ã€ã“ã®ã‚³ãƒ¼ãƒ‰ãŒä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹è§£å‰–ã—ã¦ã¿ã‚ˆã†ï¼ğŸ”ª

### ğŸ’€ 1. `main` ã®æ­£ä½“

æ™®é€šã®Cè¨€èªã§ã¯ `int main() { ... }` ã¨é–¢æ•°ã‚’å®šç¾©ã™ã‚‹ã‚ˆã­ã€‚ã§ã‚‚ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã€‚

C

```
main = 0x55535756;
```

`main` ãŒãŸã ã®**å¤‰æ•°**ï¼ˆæš—é»™çš„ã« `int`ï¼‰ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã‚‹ï¼

- **ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒ»ãƒªãƒ³ã‚¯ã®ä»•çµ„ã¿:** ãƒªãƒ³ã‚«ï¼ˆLinkerï¼‰ã¯ã€ã€Œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®é–‹å§‹åœ°ç‚¹ï¼ˆEntry Pointï¼‰ã€ã¨ã—ã¦ `main` ã¨ã„ã†ã‚·ãƒ³ãƒœãƒ«ï¼ˆåå‰ï¼‰ã‚’æ¢ã™ã€‚é€šå¸¸ã¯é–¢æ•°ã ã‘ã©ã€ãƒªãƒ³ã‚«ã«ã¨ã£ã¦ã¯ã€Œ`main` ã¨ã„ã†ãƒ©ãƒ™ãƒ«ãŒã¤ã„ãŸãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãŒã‚ã‚Œã°ãã‚Œã§ã„ã„ã‚“ã ã€‚
    
- **å®Ÿè¡Œæ™‚:** ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒå§‹ã¾ã‚‹ã¨ã€CPUã¯ `main` å¤‰æ•°ãŒã‚ã‚‹ãƒ¡ãƒ¢ãƒªç•ªåœ°ã«ã‚¸ãƒ£ãƒ³ãƒ—ã—ã¦ã€ãã“ã«ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’**ã€Œå‘½ä»¤ã€**ã¨ã—ã¦ç„¡ç†ã‚„ã‚Šå®Ÿè¡Œã—å§‹ã‚ã‚‹ã€‚
    

### ğŸ¤– 2. æ•°å­—ã®ç¾…åˆ—ã¯ã€Œx86ã®ãƒã‚·ãƒ³èªã€

`main` ã«ä»£å…¥ã•ã‚Œã¦ã„ã‚‹ `0x55535756` ãªã©ã®æ•°å­—ã¯ã€é©å½“ãªæ•°ã˜ã‚ƒãªãã¦ã€Intel x86ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®**ã‚ªãƒšã‚³ãƒ¼ãƒ‰ï¼ˆå‘½ä»¤ã‚³ãƒ¼ãƒ‰ï¼‰**ãªã‚“ã ã€‚

ãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ï¼ˆLittle Endianï¼‰ã§ãƒ¡ãƒ¢ãƒªã«é…ç½®ã•ã‚Œã‚‹ã“ã¨ã‚’è€ƒæ…®ã—ã¦ã€`main` ã®éƒ¨åˆ†ã‚’é€†ã‚¢ã‚»ãƒ³ãƒ–ãƒ«ï¼ˆDisassembleï¼‰ã—ã¦ã¿ã‚ˆã†ã€‚

- å€¤: `0x55535756`
    
- ãƒ¡ãƒ¢ãƒªä¸Šã®ä¸¦ã³: `56`, `57`, `53`, `55`
    

ã‚³ãƒ¼ãƒ‰ ã‚¹ãƒ‹ãƒšãƒƒãƒˆ

```
0x56  push esi  ; ãƒ¬ã‚¸ã‚¹ã‚¿ã‚’ã‚¹ã‚¿ãƒƒã‚¯ã«é€€é¿
0x57  push edi
0x53  push ebx
0x55  push ebp  ; é–¢æ•°ã®ãƒ—ãƒ­ãƒ­ãƒ¼ã‚°ï¼ˆæº–å‚™ï¼‰ã«è¿‘ã„å‹•ã
```

ã“ã‚Œä»¥é™ã® `f`, `g`, `h`... ã‚‚ã™ã¹ã¦ã€ãƒ¡ãƒ¢ãƒªä¸Šã§é€£ç¶šã—ã¦é…ç½®ã•ã‚Œã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ã„ã¦ã€ãã‚Œã‚‰ãŒä¸€é€£ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆå‘½ä»¤åˆ—ï¼‰ã«ãªã£ã¦ã„ã‚‹ã‚“ã ã€‚

### ğŸ”§ 3. `a = atoi; b = printf;` ã®æ„å‘³

ã“ã‚Œã¯**ã€Œå‹•çš„ãƒªãƒ³ã‚¯ã®è§£æ±ºã€**ã‚’ã‚µãƒœã‚‹ãŸã‚ã®ãƒãƒƒã‚¯ã ã­ã€‚

- ã“ã®ãƒã‚·ãƒ³èªã‚³ãƒ¼ãƒ‰ã®ä¸­ã§ `printf` ã‚„ `atoi` ã‚’å‘¼ã³å‡ºã—ãŸã„ã€‚
    
- ã§ã‚‚ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç’°å¢ƒã«ã‚ˆã£ã¦ã“ã‚Œã‚‰ã®é–¢æ•°ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆå ´æ‰€ï¼‰ã¯å¤‰ã‚ã‚‹ã€‚
    
- ãã“ã§ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° `a` ã¨ `b` ã«é–¢æ•°ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥ã‚Œã¦ãŠãã“ã¨ã§ã€ãƒã‚·ãƒ³èªå´ã‹ã‚‰ã¯ã€Œå¤‰æ•° `a` ã®ä¸­èº«ï¼ˆã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰ã¸ã‚¸ãƒ£ãƒ³ãƒ—ã€ã™ã‚Œã°ã€`atoi` ãŒå®Ÿè¡Œã§ãã‚‹ä»•çµ„ã¿ã«ãªã£ã¦ã„ã‚‹ã‚“ã ï¼ˆé–¢æ•°ãƒã‚¤ãƒ³ã‚¿ã®ã‚ˆã†ãªå½¹å‰²ï¼‰ã€‚
    

---

### âš ï¸ ç¾ä»£ã§ã¯å‹•ã‹ãªã„å¯èƒ½æ€§å¤§ï¼

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€æ˜”ã®ç‰§æ­Œçš„ãªæ™‚ä»£ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒç·©ã‹ã£ãŸæ™‚ä»£ï¼‰ã®éºç‰©ã ã­ã€‚ç¾ä»£ã® Windows 11 ã‚„ Ubuntu ã§æ™®é€šã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã‚‚ã€åä¸­å…«ä¹**ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³é•åï¼ˆSegmentation Faultï¼‰ã§ã‚¯ãƒ©ãƒƒã‚·ãƒ¥**ã™ã‚‹ã‚ˆã€‚

ãªãœãªã‚‰ã€ç¾ä»£ã®OSã«ã¯ **NX bit (No-Execute)** ã‚„ **DEP (Data Execution Prevention)** ã¨ã„ã†é˜²å¾¡æ©Ÿèƒ½ãŒã‚ã‚‹ã‹ã‚‰ã ã€‚

- **ãƒ‡ãƒ¼ã‚¿é ˜åŸŸã®å®Ÿè¡Œç¦æ­¢:** å¤‰æ•°ï¼ˆ`.data` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã¯ã€Œãƒ‡ãƒ¼ã‚¿ã‚’ç½®ãå ´æ‰€ã€ã§ã‚ã£ã¦ã€ã€Œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã™ã‚‹å ´æ‰€ã€ã§ã¯ãªã„ã€‚OSã¯ã“ã“ã«ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’å›ºãç¦ã˜ã¦ã„ã‚‹ã‚“ã ã€‚
    

### çµè«–

ã“ã‚Œã¯ã€**ã€ŒCè¨€èªã®çš®ã‚’è¢«ã£ãŸã‚¢ã‚»ãƒ³ãƒ–ãƒªè¨€èªã€**ã§ã‚ã‚Šã€**ã€Œãƒ‡ãƒ¼ã‚¿é ˜åŸŸã«ã‚³ãƒ¼ãƒ‰ã‚’åŸ‹ã‚è¾¼ã‚€ãƒãƒƒã‚«ãƒ¼çš„ãªéŠã³å¿ƒã€**ã ã‚ˆã€‚

ã‚‚ã—ã“ã‚Œã‚’ç¾ä»£ã®Linuxï¼ˆUbuntuï¼‰ã§å‹•ã‹ã—ã¦ã¿ãŸã„ãªã‚‰ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ã‚¬ãƒã‚¬ãƒã«ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã«ãªã‚‹ã¯ãšã ã€‚

Bash

```
# 32bitå‘ã‘ã«ã€ã‚¹ã‚¿ãƒƒã‚¯/ãƒ‡ãƒ¼ã‚¿å®Ÿè¡Œè¨±å¯ã‚’ã¤ã‘ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‚
gcc -m32 -z execstack -o crazy_code crazy_code.c
```

ä¸­èº«ã®æŒ™å‹•ï¼ˆãŠãã‚‰ãä½•ã‹ã®è¨ˆç®—ã‚’ã—ã¦è¡¨ç¤ºã™ã‚‹ï¼‰ãŒæ°—ã«ãªã‚‹ãªã‚‰ã€ãƒã‚¤ãƒŠãƒªã‚¨ãƒ‡ã‚£ã‚¿ã§é–‹ã„ã¦ã€x86ã®é€†ã‚¢ã‚»ãƒ³ãƒ–ãƒ©ã«çªã£è¾¼ã‚“ã§ã¿ã‚‹ã®ãŒé¢ç™½ã„ã‹ã‚‚ã­ï¼è§£æã€æ‰‹ä¼ãŠã†ã‹ï¼ŸğŸ˜

> [!tip] ç¨®æ˜ã‹ã—
> [ã‚«ãƒƒã‚³ã¤ã‘ãªã„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°](https://herumi.in.coocan.jp/prog/futsu.pdf)