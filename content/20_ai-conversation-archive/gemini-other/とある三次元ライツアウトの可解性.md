---
tags:
  - gemini
  - math
  - algorithm
---

> [!quote]+ Prompt
> 「ライツアウト」について考える。
> 各pixelにはonとoffの状態があり、最初は全てonの状態から始まる。  
> 選択したpixelとそれに隣接するpixelの状態を切り替えることができる。  
> 全ての状態をoffにすることでゲームクリアとなる。
> 
> 通常のライツアウトは2次元だが、3次元の場合も考えてみる。  
> 奥行きが追加されるが、ルールは同じである。
> 
> 今回は3x3x3のケースで考える。  
> 全てのvoxelがonの状態から全てをoffにすることは、全てのvoxelが触れられる状態であるならば可能であることが既知であるが…
> 
> 問題。もし中心の1voxelのみ、直接触れることが出来ず、隣接した6voxelの操作でのみ状態を変えられるとしたら、解くことは可能か…？
> 

わー！これは面白い思考実験だね！ライツアウトを3次元に拡張して、さらに「触れない」という制約を設けるなんて、最高にワクワクするじゃないか！君は情報工学を学んでいるから、こういうアルゴリズミックで数学的なパズルは得意分野かもしれないね！

さっそく結論から言っちゃうと、その条件下では…残念ながら**不可能**なんだ！

なぜ不可能なのか、その理由を順を追って楽しく解説していくね！

### ライツアウトと数学の素敵な関係

このパズル、実は背後に「GF(2)上の線形代数」っていう、いかにも専門的でカッコいい数学が隠れているんだ。GF(2)っていうのは、簡単に言うと「0と1しかなくて、足し算は繰り上がりを無視する（XOR演算と同じ）世界」のこと。

- `0+0=0`
    
- `0+1=1`
    
- `1+0=1`
    
- `1+1=0` (←これがミソ！)
    

voxelの状態を on=1, off=0 と考えれば、まさにこの世界そのものだよね！ voxelを「押す」という操作も、1を加える（状態を反転させる）ことに相当するんだ。

### 唯一無二の解法

まず大前提として、この3x3x3のライツアウト（制約なし）は、どんな初期状態からでも**必ず解ける**ことが知られている。そして、その解法（どのvoxelを何回押すか）は、各初期状態に対して**ただ一通り**に定まるんだ。これは、このパズルを行列で表現したときに、その行列が「正則」である（逆行列が存在する）ことを意味している。

つまり、「全部がonの状態」からスタートした場合、それをクリアするための「押すべきvoxelの組み合わせ」は、たった一つしかないんだよ。

### 問題の核心：その唯一の解法はどんなパターン？

じゃあ、その「全部on」をクリアするための唯一の解法パターンがどんなものか、調べてみようじゃないか！

このパズルは完全な対称性を持っているから、解法パターンも対称的になるはずだ。voxelをその位置によって4種類に分類してみよう。

1. **センター (Center)**: 立方体のど真ん中 (1個)
    
2. **フェイスセンター (Face-Center)**: 各面の中心 (6個)
    
3. **エッジ (Edge)**: 辺の真ん中 (12個)
    
4. **コーナー (Corner)**: 角 (8個)
    

解法パターンにおいて、同じ種類のvoxelは全て同じように扱われるはず。つまり、「コーナーを全部押すか、全部押さないか」のどっちか、という感じだね。

そこで、それぞれの種類のvoxelを押すか押さないかを $x_{center}, x_{face}, x_{edge}, x_{corner}$ (押す=1, 押さない=0) として、方程式を立ててみよう。各voxelが最終的にoff(0)になるためには、初期状態の1に、自身と隣接するvoxelからのフリップ（押された回数）の合計が1になればいい ( $1+1=0$ だからね！)。

1. **センターvoxelがoffになるには？**
    
    - 初期状態: 1
        
    - フリップ回数: $x_{center}$ (自分自身) + $6 \cdot x_{face}$ (隣接する6つのフェイスセンター)
        
    - 方程式 (mod 2): $1 + x_{center} + 6x_{face} \equiv 0 \implies 1 + x_{center} \equiv 0 \implies \boldsymbol{x_{center} = 1}$
        
2. **フェイスセンターvoxelがoffになるには？**
    
    - 初期状態: 1
        
    - フリップ回数: $x_{face}$ (自分) + $4 \cdot x_{edge}$ (隣) + $1 \cdot x_{center}$ (隣)
        
    - 方程式 (mod 2): $1 + x_{face} + 4x_{edge} + x_{center} \equiv 0 \implies 1 + x_{face} + x_{center} \equiv 0$
        
    - 上で $x_{center}=1$ と分かったから、代入して $\implies 1 + x_{face} + 1 \equiv 0 \implies \boldsymbol{x_{face} = 0}$
        
3. **エッジvoxelがoffになるには？**
    
    - 初期状態: 1
        
    - フリップ回数: $x_{edge}$ (自分) + $2 \cdot x_{corner}$ (隣) + $2 \cdot x_{face}$ (隣)
        
    - 方程式 (mod 2): $1 + x_{edge} + 2x_{corner} + 2x_{face} \equiv 0 \implies 1 + x_{edge} \equiv 0 \implies \boldsymbol{x_{edge} = 1}$
        
4. **コーナーvoxelがoffになるには？**
    
    - 初期状態: 1
        
    - フリップ回数: $x_{corner}$ (自分) + $3 \cdot x_{edge}$ (隣)
        
    - 方程式 (mod 2): $1 + x_{corner} + 3x_{edge} \equiv 0 \implies 1 + x_{corner} + x_{edge} \equiv 0$
        
    - 上で $x_{edge}=1$ と分かったから、代入して $\implies 1 + x_{corner} + 1 \equiv 0 \implies \boldsymbol{x_{corner} = 0}$
        

### 導き出された結論

この連立方程式を解いた結果、唯一の解法パターンが判明した！

- **センター voxel: 押す ($x_{center}=1$)**
    
- フェイスセンター voxel: 押さない ($x_{face}=0$)
    
- **エッジ voxel: 押す ($x_{edge}=1$)**
    
- コーナー voxel: 押さない ($x_{corner}=0$)
    

つまり、3x3x3のライツアウトを「全部on」の状態からクリアするには、**「ど真ん中の1個と、辺の中央にある12個の、合計13個のvoxelを押す」** という操作が**必要不可欠**なんだ。

君の提起した問題は、「中心の1voxelのみ、直接触れることが出来ない」というものだったよね。

これは、唯一の解法に含まれている**「センターvoxelを押す」という操作を実行できない**ことを意味する。

唯一の正解への道が、ルールによって閉ざされてしまっている。

だから、この条件下で全てのvoxelをoffにすることは、論理的に不可能ということになるんだ！

面白い問題提起をありがとう！こういう風にルールを一つ変えるだけで、可能性そのものが閉ざされてしまうなんて、奥が深いよね！また何か面白いアイデアが浮かんだら、ぜひ聞かせておくれ！